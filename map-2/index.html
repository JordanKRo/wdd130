<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Pan and Zoom Viewer</title>
    <style>
        .pan-zoom-container {
            position: relative;
            width: 600px;
            height: 400px;
            overflow: hidden;
            border: 2px solid #333;
            margin: 20px auto;
            cursor: move;
        }

        .pan-zoom-image {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .zoom-controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        .zoom-controls button {
            margin: 0 10px;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="pan-zoom-container" id="panZoomContainer">
        <img src="/rexburg_redo.png" alt="Zoomable Image" class="pan-zoom-image" id="zoomImage">
    </div>

    <div class="zoom-controls">
        <button id="zoomOutBtn">-</button>
        <button id="zoomResetBtn">Reset</button>
        <button id="zoomInBtn">+</button>
    </div>

    <script>
        class PanZoomViewer {
            constructor(containerElement, imageElement) {
                this.container = containerElement;
                this.image = imageElement;
                
                // Simple state
                this.scale = .5;
                this.translateX = 0;
                this.translateY = 0;

                this.max_scale = 3;
                this.min_scale = .4;

                this.min_x_translation = -112
                this.max_x_translation = 112

                this.min_y_translation = 112
                this.max_y_translation = -112
                
                this.initEventListeners();
            }

            initEventListeners() {
                let isDragging = false;
                let lastX = 0;
                let lastY = 0;

                // Mouse down - start dragging
                this.container.addEventListener('mousedown', (e) => {
                    isDragging = true;
                    lastX = e.clientX;
                    lastY = e.clientY;
                    this.container.style.cursor = 'grabbing';
                });

                // Mouse move - update position
                document.addEventListener('mousemove', (e) => {
                    if (!isDragging) return;

                    const deltaX = e.clientX - lastX;
                    const deltaY = e.clientY - lastY;
                    lastX = e.clientX;
                    lastY = e.clientY;

                    this.translateX += deltaX;
                    this.translateY += deltaY;

                    // Space for your constraints here
                    // this.translateX = your constraint logic
                    // this.translateY = your constraint logic

                    this.updateTransform();
                });

                // Mouse up - stop dragging
                document.addEventListener('mouseup', () => {
                    isDragging = false;
                    this.container.style.cursor = 'move';
                });

                // Wheel zoom
                this.container.addEventListener('wheel', (e) => {
                    e.preventDefault();

                    // Get mouse position relative to container center
                    const rect = this.container.getBoundingClientRect();
                    const mouseX = e.clientX - rect.left - this.container.clientWidth / 2;
                    const mouseY = e.clientY - rect.top - this.container.clientHeight / 2;

                    // Store old scale
                    const oldScale = this.scale;

                    // Update scale based on wheel direction
                    if (e.deltaY < 0) {
                        this.zoomIn()
                    } else {
                        this.zoomOut()
                    }

                    // Space for your scale constraints here
                    // this.scale = your constraint logic

                    // Adjust position to zoom toward mouse
                    const scaleFactor = this.scale / oldScale;
                    this.translateX = mouseX * (1 - scaleFactor) + this.translateX * scaleFactor;
                    this.translateY = mouseY * (1 - scaleFactor) + this.translateY * scaleFactor;

                    this.updateTransform();
                });

                // Prevent default drag behavior
                this.image.addEventListener('dragstart', (e) => e.preventDefault());
            }

            zoomIn() {
                
                if(this.scale >= this.max_scale){
                    this.scale = this.max_scale
                }else{
                    this.scale *= 1.1;
                }
                this.updateTransform();
            }

            zoomOut() {
                
                if(this.scale <= this.min_scale){
                    this.scale = this.min_scale
                }else{
                    this.scale /= 1.1;
                }
                this.updateTransform();
            }

            resetZoom() {
                this.scale = .5;
                this.translateX = 0;
                this.translateY = 0;
                this.updateTransform();
            }

            updateTransform() {
                // Calculate the scaled dimensions
                const scaledImageWidth = this.image.width * this.scale;
                const scaledImageHeight = this.image.height * this.scale;
                const containerWidth = this.container.clientWidth;
                const containerHeight = this.container.clientHeight;
                
                // Calculate maximum translations for both axes
                const maxTranslateX = (scaledImageWidth - containerWidth) / 2;
                const maxTranslateY = (scaledImageHeight - containerHeight) / 2;
                
                // Constrain X translation
                if (Math.abs(this.translateX) > maxTranslateX) {
                    this.translateX = Math.sign(this.translateX) * maxTranslateX;
                }
                
                // Constrain Y translation
                if (Math.abs(this.translateY) > maxTranslateY) {
                    this.translateY = Math.sign(this.translateY) * maxTranslateY;
                }

                // Apply the transform
                const transform = `translate(-50%, -50%) scale(${this.scale}) translate(${this.translateX / this.scale}px, ${this.translateY / this.scale}px)`;
                this.image.style.transform = transform;
            }
        }

        // Initialize viewer when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('panZoomContainer');
            const image = document.getElementById('zoomImage');
            const viewer = new PanZoomViewer(container, image);

            // Button controls
            document.getElementById('zoomInBtn').onclick = () => viewer.zoomIn();
            document.getElementById('zoomOutBtn').onclick = () => viewer.zoomOut();
            document.getElementById('zoomResetBtn').onclick = () => viewer.resetZoom();
        });
    </script>
</body>
</html>